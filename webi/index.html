<!DOCTYPE html>
<html>
<head>
  <title>Remote</title>
  <link rel="stylesheet" href="style.css">
</head>
<body onload="onLoad()">
  <div class="mainContainer">
    <h1>Remote</h1>
    <p>Content counter <span id="cnt">???</span></p>
    <p>Left <span id="stateLeft">???</span> Right <span id="stateRight">???</span> Up <span id="stateUp">???</span> Down <span id="stateDown">???</span></p>
    <p>Light <span id="stateLight">???</span></p>
    <p>Accel <span id="actAcc">???</span> Dir <span id="actDir">???</span></p>
    <p>Battery voltage <span id="actBat">???</span>V</p>
  </div>
  <div class="leftButtonsContainer">
      <button type="button" id="btnUp" class="navyButton row">
        <svg viewBox="0 0 100 100" preserveAspectRatio="none">
          <path d="M0 85 L0 75 L50 15 L100 75 L100 85 L50 35 Z" vector-effect="non-scaling-stroke"/>
        </svg>
      </button>
      <button type="button" id="btnDown" class="navyButton row">
        <svg viewBox="0 0 100 100" preserveAspectRatio="none">
          <path d="M0 15 L0 25 L50 85 L100 25 L100 15 L50 65 Z" vector-effect="non-scaling-stroke"/>
        </svg>
      </button>
    </div>
  </div>
  <div class="rightButtonsContainer">
    <button type="button" id="btnLeft" class="navyButton column">
      <svg viewBox="0 0 100 100" preserveAspectRatio="none">
        <path d="M75 0 L85 0 L35 50 L85 100 L75 100 L15 50 Z" vector-effect="non-scaling-stroke"/>
      </svg>
    </button>
    <button type="button" id="btnRight" class="navyButton column">
      <svg viewBox="0 0 100 100" preserveAspectRatio="none">
        <path d="M15 0 L25 0 L85 50 L25 100 L15 100 L65 50 Z" vector-effect="non-scaling-stroke"/>
      </svg>
    </button>
  </div>
  <div class="menuContainer">
    <!--<button type="button" id="btnMenu" class="menuButton">
        <svg viewBox="0 0 512 512" preserveAspectRatio="none">
            <path d="M362.7,0C338.8,0,320,17.1,320,37.5v102.4c0,20.5,18.8,37.5,42.7,37.5c23.9,0,42.7-17.1,42.7-37.5V37.5 C405.3,17.1,386.6,0,362.7,0z M0,70.8v35.8h298.7V70.8H0z M426.7,70.8v35.8H512V70.8H426.7z M149.3,170.7 c-23.9,0-42.7,17.1-42.7,37.5v102.4c0,20.5,18.8,37.5,42.7,37.5s42.7-17.1,42.7-37.5V208.2C192,187.7,173.2,170.7,149.3,170.7z M0,241.5v35.8h85.3v-35.8H0z M213.3,241.5v35.8H512v-35.8H213.3z M362.7,334.5c-23.9,0-42.7,17.1-42.7,37.5v102.4 c0,20.5,18.8,37.5,42.7,37.5c23.9,0,42.7-17.1,42.7-37.5V372.1C405.3,350.7,386.6,334.5,362.7,334.5z M0,405.3v35.8h298.7v-35.8H0z M426.7,405.3v35.8H512v-35.8H426.7z" vector-effect="non-scaling-stroke"/>
        </svg>
    </button>-->
    <button type="button" id="btnLight" class="menuButton">
        <svg viewBox="0 0 114.1 122.88" preserveAspectRatio="none">
            <path d="M75.84,27.1a35.68,35.68,0,0,1,8.61,7.09,32.45,32.45,0,0,1,5.76,9.26h0a36.84,36.84,0,0,1,1.85,6,34.64,34.64,0,0,1,.24,14,38.69,38.69,0,0,1-2.15,7.32l-.12.25c-2.06,5-5.59,9.86-9,14.66-1.75,2.42-3.48,4.82-4.94,7.15A4.69,4.69,0,0,1,71.73,95l-27.56,4.1A4.7,4.7,0,0,1,39,95.69a40.19,40.19,0,0,0-2.54-5.82,24.85,24.85,0,0,0-3-4.49c-1.43-1.63-2.88-3.29-4.29-5.2A40.42,40.42,0,0,1,25,73.24h0a41.08,41.08,0,0,1-2.81-8,35.84,35.84,0,0,1-.95-8.45v0A35.39,35.39,0,0,1,22.35,48a41.69,41.69,0,0,1,3.42-8.85l.2-.35a35.55,35.55,0,0,1,7.13-8.63,33.72,33.72,0,0,1,9.46-5.83l.28-.1a35.41,35.41,0,0,1,8-2.14,37.78,37.78,0,0,1,8.77-.2,39.14,39.14,0,0,1,8.4,1.71,38.44,38.44,0,0,1,7.79,3.49Zm-4,87.26a17.37,17.37,0,0,1-6.28,6.29,16.46,16.46,0,0,1-7.2,2.2A14.87,14.87,0,0,1,51,121.4a15.1,15.1,0,0,1-4.39-3.27l25.29-3.77Zm2.41-14.15,0,1.65,0,.58a22,22,0,0,1,0,3.25l-.49,2.39-30.64,4.56-.54-1.23-1.19-4.9,0-1.42,32.79-4.88ZM56.34,3.77A3.84,3.84,0,0,1,60.23,0h0l.27,0A3.84,3.84,0,0,1,64,3.89h0a1.27,1.27,0,0,1,0,.2l-.21,8.21h0a2.11,2.11,0,0,1,0,.26,3.84,3.84,0,0,1-3.87,3.54h0l-.27,0a3.84,3.84,0,0,1-3.53-3.88h0a1.09,1.09,0,0,1,0-.19l.2-8.25ZM14,18.15a3.84,3.84,0,0,1,2.47-6.66,3.83,3.83,0,0,1,2.76,1l6.16,5.73a3.91,3.91,0,0,1,1.22,2.68,3.82,3.82,0,0,1-1,2.76,3.86,3.86,0,0,1-2.67,1.22,3.8,3.8,0,0,1-2.76-1L14,18.15ZM3.92,60.48A3.86,3.86,0,0,1,0,56.75a3.84,3.84,0,0,1,3.73-4l8.41-.28a3.84,3.84,0,0,1,4,3.72v.06h0v.14a3.84,3.84,0,0,1-3.73,3.77h-.15l-8.3.27Zm106-11.92H110a3.84,3.84,0,0,1,2.66.86,3.81,3.81,0,0,1,1.4,2.59v0a.49.49,0,0,1,0,.13,3.84,3.84,0,0,1-3.44,4.06l-8.37.89a3.83,3.83,0,0,1-2.81-.85,3.84,3.84,0,0,1,2-6.8c2.79-.31,5.6-.63,8.4-.9ZM93.33,15.09A3.83,3.83,0,0,1,98.65,14h0a3.73,3.73,0,0,1,1.63,2.44,3.84,3.84,0,0,1-.58,2.88l-4.68,7A3.8,3.8,0,0,1,92.58,28a3.88,3.88,0,0,1-2.88-.57A3.92,3.92,0,0,1,88.06,25a3.84,3.84,0,0,1,.58-2.88l4.69-7ZM38.23,80.87A42.19,42.19,0,0,1,31,70.56,31.2,31.2,0,0,1,27.89,57,31.7,31.7,0,0,1,31.7,42.56a.47.47,0,0,0,.05-.1h0a27.5,27.5,0,0,1,13.4-11.71,29.65,29.65,0,0,1,13.93-2A32.09,32.09,0,0,1,72.39,33,27.43,27.43,0,0,1,84,46.2,28.85,28.85,0,0,1,84,68.45C81.31,75,75.15,82,71.11,88.4a1.67,1.67,0,0,0-.67,0L44.36,92.25a35,35,0,0,0-6.13-11.38Z" vector-effect="non-scaling-stroke"/>
        </svg>
    </button>
  </div>
  <script>
    // get json data
    var getJSON = function(url, callback) {
      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.responseType = 'json';
      xhr.onload = function() {
        var status = xhr.status;
        if (status === 200) {
          callback(null, xhr.response);
        } else {
          callback(status, xhr.response);
        }
      };
      xhr.send();
    }

    // function adds or removes class of the element
    function add_remove_class(element_id, class_state, class_name) {
      var element = document.getElementById(element_id);
      if (class_state)
        element.classList.add(class_name);
      else
        element.classList.remove(class_name);
    }

    function update_data(data){
      document.getElementById('cnt').innerText = data['cnt'];
      document.getElementById('stateLeft').innerText = data['control']['left'] ? 'ON' : 'OFF';
      document.getElementById('stateRight').innerText = data['control']['right'] ? 'ON' : 'OFF';
      document.getElementById('stateUp').innerText = data['control']['up'] ? 'ON' : 'OFF';
      document.getElementById('stateDown').innerText = data['control']['down'] ? 'ON' : 'OFF';
      document.getElementById('stateLight').innerText = data['control']['light'] ? 'ON' : 'OFF';
      add_remove_class('btnRight', data['control']['right'], 'active');
      add_remove_class('btnLeft', data['control']['left'], 'active');
      add_remove_class('btnUp', data['control']['up'], 'active');
      add_remove_class('btnDown', data['control']['down'], 'active');
      add_remove_class('btnLight', data['control']['light'], 'active');
      document.getElementById('actAcc').innerText = data['actual']['acc'];
      document.getElementById('actDir').innerText = data['actual']['dir'];
      document.getElementById('actBat').innerText = data['actual']['bat'].toFixed(2);
    }

    function update(){
      getJSON('data.json', function(err, data) {
        if (err !== null) {
          console.log('No data response!');
          setTimeout(update, 5000);
        } else {
          update_data(data);
          setTimeout(update, 500);
        }
      });
    };

    function send_data(data) {
      var xhr = new XMLHttpRequest();
      var url = "data.json";
      xhr.open("POST", url, true);
      xhr.setRequestHeader("Content-Type", "application/json");
      xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        var json = JSON.parse(xhr.responseText);
        update_data(json);
      }
      };
      var dataToSend = JSON.stringify(data);
      xhr.send(dataToSend);
    }

    var data = {'btnLeft': false, 'btnRight': false, 'btnUp': false, 'btnDown': false, 'btnLight': false}

    function btnStart(id) {
      if (!data[id]) {
        console.log('BTN ' + id + ' START');
        data[id] = true;
        send_data(data);
      }
    }
    function btnStop(id) {
      if (data[id]) {
        data[id] = false;
        console.log('BTN ' + id + ' STOP');
        send_data(data);
      }
    }

    function btnToggle(id) {
      data[id] = !data[id];
      console.log('BTN ' + id + ' TOGGLE');
      send_data(data)
    }

    function btnInit(id) {
      let btn = document.getElementById(id);
      btn.onmousedown = function(event) { btnStart(id); }
      btn.ontouchstart = function(event) { btnStart(id); }
      btn.onmouseup = function(event) { btnStop(id); }
      btn.onmouseout = function(event) { btnStop(id); }
      btn.ontouchend = function(event) { btnStop(id); }
      btn.ontouchcancel = function(event) { btnStop(id); }
    }

    function btnInitToggle(id) {
      let btn = document.getElementById(id);
      btn.onclick = function(event) { btnToggle(id); }
    }

    function onLoad(){
      btnInit('btnRight');
      btnInit('btnLeft');
      btnInit('btnUp');
      btnInit('btnDown');
      btnInitToggle('btnLight');
      update();
    }
  </script>
</body>
</html>
